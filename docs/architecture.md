# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Slack User  â”‚
â”‚  (@bot ...)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ app_mention / interactive
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway     â”‚     â”‚  Slack API               â”‚
â”‚  (HTTP API)      â”‚     â”‚  - chat_postMessage      â”‚
â”‚                  â”‚     â”‚  - chat_update           â”‚
â”‚  POST /slack/    â”‚     â”‚  - views_open            â”‚
â”‚    events        â”‚     â”‚  - users_info            â”‚
â”‚  POST /slack/    â”‚â—„â”€â”€â”€â”€â”‚                          â”‚
â”‚    interactive   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  GET /oauth/     â”‚               â–²
â”‚    google/       â”‚               â”‚ response
â”‚    callback      â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
       â”‚                           â”‚
       â–¼                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”
â”‚  Lambda (Python 3.11 / Slack Bolt)   â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  app.py (Handler Router)        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ /slack/events â†’ Bolt       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ /slack/interactive â†’ Bolt  â”‚ â”‚
â”‚  â”‚  â””â”€â”€ /oauth/callback â†’ Direct   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Handlers                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ message_handler            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ interactive_handler        â”‚ â”‚
â”‚  â”‚  â””â”€â”€ oauth_handler              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Services                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ bedrock_service            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ calendar_service           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ token_service              â”‚ â”‚
â”‚  â”‚  â””â”€â”€ conversation_service       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Tools / Utils                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ tool_executor              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ calendar_tools (å®šç¾©)      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ slack_utils                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ time_utils                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€ secrets_utils              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚          â”‚          â”‚
       â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bedrock  â”‚ â”‚DynamoDBâ”‚ â”‚Secrets       â”‚
â”‚ Claude   â”‚ â”‚        â”‚ â”‚Manager       â”‚
â”‚ 3.5      â”‚ â”‚2 tablesâ”‚ â”‚              â”‚
â”‚ Sonnet   â”‚ â”‚        â”‚ â”‚- Slack creds â”‚
â”‚          â”‚ â”‚        â”‚ â”‚- Google credsâ”‚
â”‚ Tool Use â”‚ â”‚        â”‚ â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Google          â”‚
       â”‚ Calendar API    â”‚
       â”‚ - FreeBusy      â”‚
       â”‚ - Events        â”‚
       â”‚ - OAuth 2.0     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## AWS ãƒªã‚½ãƒ¼ã‚¹æ§‹æˆ

| ãƒªã‚½ãƒ¼ã‚¹ | åå‰ | ç”¨é€” |
|---------|------|------|
| API Gateway (HTTP API) | `{project}-api-{env}` | ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ (3ãƒ«ãƒ¼ãƒˆ) |
| Lambda | `{project}-{env}` | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“ (Python 3.11) |
| DynamoDB | `{project}-conversations-{env}` | ä¼šè©±çŠ¶æ…‹ + ä¿ç•™ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (TTLä»˜ã) |
| DynamoDB | `{project}-oauth-tokens-{env}` | Google OAuthãƒˆãƒ¼ã‚¯ãƒ³ (æš—å·åŒ–) |
| Secrets Manager | `{project}/slack-{env}` | Slack Bot Token / Signing Secret |
| Secrets Manager | `{project}/google-{env}` | Google OAuth Client ID / Secret |
| CloudWatch Logs | 2ã‚°ãƒ«ãƒ¼ãƒ— | API Gateway + Lambda ãƒ­ã‚° (14æ—¥ä¿æŒ) |
| Bedrock | Claude 3.5 Sonnet (APAC) | æ„å›³ç†è§£ + Tool Use |

## API Gateway ãƒ«ãƒ¼ãƒˆ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | å‡¦ç†å…ˆ | ç”¨é€” |
|---------|------|-------|------|
| POST | `/slack/events` | Slack Bolt | app_mention ã‚¤ãƒ™ãƒ³ãƒˆ |
| POST | `/slack/interactive` | Slack Bolt | ãƒœã‚¿ãƒ³ãƒ»ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ |
| GET | `/oauth/google/callback` | oauth_handler | Google OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ |

## DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

### conversations ãƒ†ãƒ¼ãƒ–ãƒ«

ä¼šè©±å±¥æ­´ã¨ä¿ç•™ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä¿å­˜ã€‚

| Key | Type | èª¬æ˜ |
|-----|------|------|
| `user_id` (PK) | String | Slack ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| `thread_ts` (SK) | String | ã‚¹ãƒ¬ãƒƒãƒ‰TS / `"pending_oauth"` |
| `messages` | String (JSON) | Bedrockå½¢å¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ or ä¿ç•™ãƒªã‚¯ã‚¨ã‚¹ãƒˆ |
| `ttl` | Number | TTL (ä¼šè©±: 24h, ä¿ç•™: 10min) |

### oauth-tokens ãƒ†ãƒ¼ãƒ–ãƒ«

| Key | Type | èª¬æ˜ |
|-----|------|------|
| `user_id` (PK) | String | Slack ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| `token_data` | String (JSON) | Google OAuth ãƒˆãƒ¼ã‚¯ãƒ³ (æš—å·åŒ–ä¿å­˜) |

## ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

```
app.py                          â† Lambda ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
  â”‚
  â”œâ”€â”€ handlers/                 â† ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä»˜ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ
  â”‚     â”œâ”€â”€ message_handler     â† @mention â†’ Bedrock Tool Use ãƒ«ãƒ¼ãƒ—
  â”‚     â”œâ”€â”€ interactive_handler â† Button/Modal â†’ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ“ä½œ
  â”‚     â””â”€â”€ oauth_handler       â† OAuth callback â†’ ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜ãƒ»å†å®Ÿè¡Œ
  â”‚
  â”œâ”€â”€ services/                 â† å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹æ¥ç¶š
  â”‚     â”œâ”€â”€ bedrock_service     â† Bedrock Claude API
  â”‚     â”œâ”€â”€ calendar_service    â† Google Calendar API
  â”‚     â”œâ”€â”€ token_service       â† DynamoDB (OAuth tokens)
  â”‚     â””â”€â”€ conversation_serviceâ† DynamoDB (ä¼šè©±çŠ¶æ…‹)
  â”‚
  â”œâ”€â”€ tools/                    â† Bedrock Tool Use
  â”‚     â”œâ”€â”€ calendar_tools      â† ãƒ„ãƒ¼ãƒ«å®šç¾© (JSON Schema)
  â”‚     â””â”€â”€ tool_executor       â† ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³
  â”‚
  â””â”€â”€ utils/                    â† å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        â”œâ”€â”€ slack_utils         â† Block Kit / Modal ç”Ÿæˆ
        â”œâ”€â”€ time_utils          â† JST / å–¶æ¥­æ—¥ / FreeBusyè¨ˆç®—
        â””â”€â”€ secrets_utils       â† Secrets Manager å–å¾—
```

## Bedrock Tool Use

### ãƒ„ãƒ¼ãƒ«ä¸€è¦§

| ãƒ„ãƒ¼ãƒ« | å…¥åŠ› | å‡ºåŠ›status | å¾Œç¶šãƒ•ãƒ­ãƒ¼ |
|-------|------|-----------|-----------|
| `search_free_slots` | attendees, date, duration, summary | `suggest_schedule` | å€™è£œãƒœã‚¿ãƒ³è¡¨ç¤º â†’ ãƒ¢ãƒ¼ãƒ€ãƒ« â†’ ä½œæˆ |
| `create_event` | summary, start/end_time, attendees | `suggest_create` | ç¢ºèªãƒœã‚¿ãƒ³è¡¨ç¤º â†’ ãƒ¢ãƒ¼ãƒ€ãƒ« â†’ ä½œæˆ |
| `reschedule_event` | event_id, new_start/end_time | `rescheduled` | å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| `suggest_reschedule` | event_id or event_title, date | `suggest_reschedule` | å€™è£œãƒœã‚¿ãƒ³è¡¨ç¤º â†’ å³ãƒªã‚¹ã‚±å®Ÿè¡Œ |

### Tool Use ãƒ«ãƒ¼ãƒ—

```
User Message
  â”‚
  â–¼
Bedrock Claude (+ System Prompt + Tools)
  â”‚
  â”œâ”€â”€ stop_reason: "end_turn" â†’ ãƒ†ã‚­ã‚¹ãƒˆå¿œç­”ã‚’Slackã¸é€ä¿¡
  â”‚
  â””â”€â”€ stop_reason: "tool_use" â†’ ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ
        â”‚
        â–¼
    ToolExecutor.execute()
        â”‚
        â”œâ”€â”€ oauth_required     â†’ OAuthèªè¨¼ãƒœã‚¿ãƒ³è¡¨ç¤º + ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¿ç•™
        â”œâ”€â”€ suggest_schedule   â†’ ç©ºãæ™‚é–“å€™è£œãƒœã‚¿ãƒ³è¡¨ç¤º
        â”œâ”€â”€ suggest_create     â†’ ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆç¢ºèªãƒœã‚¿ãƒ³è¡¨ç¤º
        â”œâ”€â”€ suggest_reschedule â†’ ãƒªã‚¹ã‚±å€™è£œãƒœã‚¿ãƒ³è¡¨ç¤º
        â”œâ”€â”€ rescheduled        â†’ å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        â””â”€â”€ (ãã®ä»–)           â†’ tool_result ã‚’ Bedrock ã«è¿”å´ â†’ ãƒ«ãƒ¼ãƒ—ç¶™ç¶š
                                 (æœ€å¤§5å›)
```

## ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ­ãƒ¼

### 1. ç©ºãæ™‚é–“å€™è£œ â†’ ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ

```
[å€™è£œãƒœã‚¿ãƒ³ (confirm_slot_N)]
  â”‚
  â–¼
_handle_confirm_slot
  â”‚ trigger_id ã§ Modal ã‚’ open
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  slot_confirmation_modal    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚¤ãƒ™ãƒ³ãƒˆå: [______]   â”‚ â”‚  â† åˆæœŸå€¤: AIãŒæ±ºã‚ãŸ summary
â”‚  â”‚ ğŸ“… 01/15 14:00 - 14:30 â”‚ â”‚
â”‚  â”‚ ğŸ‘¥ a@test.com          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          [äºˆç´„ã™ã‚‹]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
_handle_slot_modal_submit
  â”‚ calendar.create_event()
  â”‚ chat_update â†’ âœ… å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  â–¼
[å®Œäº†]
```

### 2. AIç›´æ¥ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ

```
Bedrock â†’ create_event ãƒ„ãƒ¼ãƒ«
  â”‚
  â–¼
tool_executor._create_event
  â”‚ status: "suggest_create" ã‚’è¿”ã™ (å®Ÿéš›ã«ã¯ä½œæˆã—ãªã„)
  â–¼
message_handler
  â”‚ build_create_confirmation_blocks â†’ ç¢ºèªãƒœã‚¿ãƒ³è¡¨ç¤º
  â–¼
[äºˆç´„ã™ã‚‹ ãƒœã‚¿ãƒ³ (confirm_create)]
  â”‚
  â–¼
_handle_confirm_create
  â”‚ trigger_id ã§ Modal ã‚’ open
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  create_confirmation_modal  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚¤ãƒ™ãƒ³ãƒˆå: [______]   â”‚ â”‚  â† åˆæœŸå€¤: AIãŒæ±ºã‚ãŸ summary
â”‚  â”‚ ğŸ“… 01/15 14:00 - 14:30 â”‚ â”‚
â”‚  â”‚ ğŸ‘¥ a@test.com          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          [äºˆç´„ã™ã‚‹]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
_handle_create_modal_submit
  â”‚ calendar.create_event()
  â”‚ chat_update â†’ âœ… å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  â–¼
[å®Œäº†]
```

### 3. ãƒªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

```
Bedrock â†’ suggest_reschedule ãƒ„ãƒ¼ãƒ«
  â”‚
  â–¼
tool_executor._suggest_reschedule
  â”‚ ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢ â†’ å‚åŠ è€…å–å¾— â†’ ç©ºãæ™‚é–“æ¤œç´¢
  â”‚ status: "suggest_reschedule" + candidates
  â–¼
message_handler
  â”‚ build_reschedule_suggestion_blocks â†’ å€™è£œãƒœã‚¿ãƒ³è¡¨ç¤º
  â–¼
[ã“ã®æ™‚é–“ã«å¤‰æ›´ ãƒœã‚¿ãƒ³ (confirm_reschedule_N)]
  â”‚
  â–¼
_handle_confirm_reschedule
  â”‚ calendar.reschedule_event()
  â”‚ chat_update â†’ âœ… ãƒªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  â–¼
[å®Œäº†]
```

## OAuthèªè¨¼ãƒ•ãƒ­ãƒ¼

```
User: @bot æ˜æ—¥ã®MTGè¨­å®šã—ã¦
  â”‚
  â–¼
message_handler â†’ tool_executor
  â”‚ credentials = None
  â”‚ return: oauth_required
  â–¼
message_handler
  â”‚ 1. OAuthèªè¨¼ãƒœã‚¿ãƒ³è¡¨ç¤º (Slack)
  â”‚ 2. save_pending_request (DynamoDB, TTL=10min)
  â–¼
User: [Googleèªè¨¼ãƒœã‚¿ãƒ³] ã‚’ã‚¯ãƒªãƒƒã‚¯
  â”‚
  â–¼
Google OAuth åŒæ„ç”»é¢
  â”‚ æ‰¿èª
  â–¼
GET /oauth/google/callback?code=...&state=user_id
  â”‚
  â–¼
oauth_handler.handle_oauth_callback
  â”‚ 1. OAuth code â†’ tokens äº¤æ›
  â”‚ 2. token_service.save_credentials (DynamoDB)
  â”‚ 3. get_pending_request â†’ ä¿ç•™ãƒªã‚¯ã‚¨ã‚¹ãƒˆå–å¾—
  â”‚ 4. delete_pending_request
  â”‚ 5. process_request â†’ å…ƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è‡ªå‹•å†å®Ÿè¡Œ
  â–¼
[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯Slackã§çµæœã‚’å—ã‘å–ã‚‹ï¼ˆå†åº¦ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ä¸è¦ï¼‰]
```

## å–¶æ¥­æ—¥ãƒ»æ™‚é–“å‡¦ç†

- **å–¶æ¥­æ™‚é–“**: 9:00 - 18:00 (JST)
- **å–¶æ¥­æ—¥**: æœˆã€œé‡‘ï¼ˆåœŸæ—¥ãƒ»æ—¥æœ¬ã®ç¥æ—¥ã‚’é™¤ãï¼‰
- **å–¶æ¥­æ—¥å¤–ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: ãƒ„ãƒ¼ãƒ«çµæœã« warning ã‚’å«ã‚ã¦è¿”å´
- **ãƒªã‚¹ã‚±ç¿Œæ—¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: å€™è£œãŒ3ä»¶æœªæº€ã®å ´åˆã€ç¿Œå–¶æ¥­æ—¥ã‚‚æ¤œç´¢
- **éå»ã‚¹ãƒ­ãƒƒãƒˆãƒ•ã‚£ãƒ«ã‚¿**: å½“æ—¥æ¤œç´¢æ™‚ã€ç¾åœ¨æ™‚åˆ»ä»¥å‰ã®ã‚¹ãƒ­ãƒƒãƒˆã‚’é™¤å¤–
- **å…ƒæ™‚é–“é™¤å¤–**: ãƒªã‚¹ã‚±å€™è£œã‹ã‚‰å…ƒã®æ™‚é–“å¸¯ã‚’é™¤å¤–

## Slackãƒ¡ãƒ³ã‚·ãƒ§ãƒ³è§£æ±º

```
User: @bot <@U12345> ã¨ <@U67890> ã®MTGã‚’è¨­å®šã—ã¦
  â”‚
  â–¼
resolve_user_mentions
  â”‚ Slack users_info API ã§å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚’å–å¾—
  â”‚ <@U12345> â†’ tanaka@example.com
  â”‚ <@U67890> â†’ sato@example.com
  â–¼
Bedrock: "tanaka@example.com ã¨ sato@example.com ã®MTGã‚’è¨­å®šã—ã¦"
```

## Slack ãƒªãƒˆãƒ©ã‚¤å¯¾ç­–

```
Slack â†’ POST /slack/events (x-slack-retry-num: 1)
  â”‚
  â–¼
app.py handler
  â”‚ x-slack-retry-num ãƒ˜ãƒƒãƒ€æ¤œå‡º
  â”‚ return 200 (å‡¦ç†ã‚¹ã‚­ãƒƒãƒ—)
  â–¼
[é‡è¤‡å‡¦ç†ã‚’é˜²æ­¢]
```
